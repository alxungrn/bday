<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>alex's birthday</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500&family=Raleway:wght@200;300;400&display=swap');



        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #fff;
            color: #444;
            font-family: 'Raleway', sans-serif;
            font-weight: 300;
            font-size: 11px;
            line-height: 1.8;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                url('https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?w=1600') center/cover fixed,
                linear-gradient(135deg, rgba(255, 182, 193, 0.4), rgba(176, 224, 230, 0.4));
            background-blend-mode: overlay;
            z-index: -1;
            opacity: 0.3;
        }

        .container {
            max-width: 600px;
            margin: 80px auto;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e0e0e0;
        }

        .title {
            font-family: 'Quicksand', sans-serif;
            font-size: 14px;
            font-weight: 300;
            letter-spacing: 6px;
            text-transform: lowercase;
            margin-bottom: 15px;
            color: #888;
        }

        .subtitle {
            font-size: 9px;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: #aaa;
            margin-top: 10px;
        }

        .section {
            margin-bottom: 50px;
            padding: 20px 0;
        }

        .section-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 11px;
            font-weight: 400;
            letter-spacing: 3px;
            text-transform: lowercase;
            color: #666;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-box {
            padding: 15px;
            margin-bottom: 15px;
            border-left: 1px solid #ddd;
            padding-left: 20px;
        }

        .detail-box h3 {
            font-family: 'Quicksand', sans-serif;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 2px;
            text-transform: lowercase;
            color: #999;
            margin-bottom: 8px;
        }

        .detail-box p {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 10px;
        }

        .timeline-time {
            font-family: 'Quicksand', sans-serif;
            min-width: 50px;
            color: #aaa;
            font-weight: 400;
        }

        .timeline-text {
            color: #666;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .gift-item {
            padding: 15px;
            border: 1px solid #f0f0f0;
            text-decoration: none;
            color: inherit;
            transition: border-color 0.3s ease;
            display: block;
        }

        .gift-item:hover {
            border-color: #ddd;
        }

        .gift-item h3 {
            font-family: 'Quicksand', sans-serif;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 1px;
            margin-bottom: 8px;
            color: #888;
        }

        .gift-item p {
            font-size: 9px;
            color: #aaa;
            line-height: 1.6;
        }

        .form-field {
            margin-bottom: 20px;
        }

        .form-field label {
            display: block;
            font-family: 'Quicksand', sans-serif;
            font-size: 9px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #999;
            margin-bottom: 8px;
        }

        .form-field input,
        .form-field textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            background: #fafafa;
            font-family: 'Raleway', sans-serif;
            font-size: 10px;
            color: #666;
        }

        .form-field input:focus,
        .form-field textarea:focus {
            outline: none;
            border-color: #ddd;
        }

        .form-field textarea {
            resize: vertical;
            min-height: 80px;
        }

        .submit-btn {
            padding: 12px 30px;
            border: 1px solid #ddd;
            background: transparent;
            font-family: 'Quicksand', sans-serif;
            font-size: 9px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: #f5f5f5;
            border-color: #ccc;
        }

        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-top: 20px;
            max-width: 500px;
        }

        .bingo-cell {
            aspect-ratio: 1;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 8px;
            padding: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .bingo-cell:hover {
            background: #f0f0f0;
        }

        .bingo-cell.marked {
            background: #e8e8e8;
            border-color: #ccc;
        }

        .bingo-cell.free {
            background: #f5f5f5;
            font-style: italic;
            color: #aaa;
        }

        .confirmation {
            margin-top: 15px;
            padding: 12px;
            border: 1px solid #e0e0e0;
            background: #fafafa;
            font-size: 9px;
            text-align: center;
            color: #888;
        }

        .rsvp-list {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .rsvp-list h3 {
            font-family: 'Quicksand', sans-serif;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 2px;
            color: #999;
            margin-bottom: 15px;
        }

        .rsvp-item {
            padding: 10px;
            margin-bottom: 10px;
            border-left: 1px solid #e0e0e0;
            padding-left: 15px;
        }

        .rsvp-item p {
            font-size: 9px;
            color: #888;
            margin-bottom: 3px;
        }

        .note {
            font-size: 9px;
            color: #aaa;
            font-style: italic;
            margin-top: 10px;
            text-align: center;
        }

        iframe {
            margin-top: 15px;
            border: 1px solid #f0f0f0;
            filter: grayscale(80%) contrast(90%);
        }

        @media (max-width: 768px) {
            .container {
                margin: 40px auto;
                padding: 30px 15px;
            }

            .bingo-grid {
                gap: 3px;
            }

            .bingo-cell {
                font-size: 7px;
                padding: 3px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title">alex's birthday</div>
            <div class="subtitle">april 18, 2026</div>
        </div>

        <!-- Details -->
        <div class="section">
            <div class="section-title">details</div>

            <div class="detail-box">
                <h3>when</h3>
                <p>april 18, 2026</p>
                <p>time tbd, probably evening</p>
            </div>

            <div class="detail-box">
                <h3>where</h3>
                <p>strada teleajen 50, floor 3, apt 6</p>
                <p>intercom: 3</p>
                <p>metro: piata muncii / piata iancului</p>

                <iframe width="100%" height="300px" frameborder="0"
                    src="https://www.google.com/maps/embed/v1/place?key=AIzaSyB2NIWI3Tv9iDPrlnowr_0ZqZWoAQydKJU&q=strada%20teleajen%2050&maptype=roadmap"
                    allowfullscreen></iframe>
            </div>
        </div>

        <!-- Timeline -->
        <div class="section">
            <div class="section-title">timeline</div>

            <div class="timeline-item">
                <div class="timeline-time">18:00</div>
                <div class="timeline-text">activity</div>
            </div>
            <div class="timeline-item">
                <div class="timeline-time">19:00</div>
                <div class="timeline-text">restaurant</div>
            </div>
            <div class="timeline-item">
                <div class="timeline-time">21:00</div>
                <div class="timeline-text">manele</div>
            </div>
            <div class="timeline-item">
                <div class="timeline-time">22:00</div>
                <div class="timeline-text">home</div>
            </div>
            <div class="timeline-item">
                <div class="timeline-time">00:00</div>
                <div class="timeline-text">continues</div>
            </div>
        </div>

        <!-- Gifts -->
        <div class="section">
            <div class="section-title">gifts</div>
            <p class="note">optional, obviously</p>
            <p class="note" style="margin-bottom: 15px;">
                <a href="https://mywishlist.online/w/rlp4wg/alexs-wishlist" style="color: #aaa;">wishlist</a>
            </p>

            <div class="gift-grid" id="giftGrid"></div>
        </div>

        <!-- RSVP -->
        <div class="section">
            <div class="section-title">rsvp</div>
            <p class="note">joint venue with robi's page</p>

            <form id="rsvpForm">
                <div class="form-field">
                    <label>name</label>
                    <input type="text" id="name" required>
                </div>

                <div class="form-field">
                    <label>attending?</label>
                    <input type="text" id="coming" required>
                </div>

                <div class="form-field">
                    <label>drinks</label>
                    <textarea id="drinks"></textarea>
                </div>

                <button type="submit" class="submit-btn">send</button>

                <div id="confirmation" class="confirmation" style="display: none;"></div>
            </form>

            <div id="rsvpList" class="rsvp-list" style="display: none;">
                <h3>confirmed</h3>
                <div id="rsvpItems"></div>
            </div>
        </div>

        <!-- Bingo -->
        <div class="section">
            <div class="section-title">party bingo</div>
            <p class="note">shared with robi's page</p>

            <div class="bingo-grid" id="bingoGrid"></div>
        </div>
    </div>

    <script>
        async function saveRSVP(name, coming, drinks) {
            try {
                const res = await fetch('/save-rsvp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, coming, drinks })
                });
                return res.ok;
            } catch (error) {
                console.error('Error saving RSVP:', error);
                return false;
            }
        }

        async function loadRSVPs() {
            try {
                const res = await fetch('/get-rsvps');
                if (!res.ok) return [];
                return await res.json();
            } catch (error) {
                console.error('Error loading RSVPs:', error);
                return [];
            }
        }

        async function loadBingo() {
            try {
                const res = await fetch('/get-bingo');
                if (!res.ok) return [];
                return await res.json();
            } catch (error) {
                console.error('Error loading bingo:', error);
                return [];
            }
        }

        async function updateBingoCell(cellIndex, checked) {
            try {
                const res = await fetch('/update-bingo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cellIndex, checked })
                });
                return res.ok;
            } catch (error) {
                console.error('Error updating bingo:', error);
                return false;
            }
        }

        async function loadGifts() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const person = urlParams.get('person');
                const res = await fetch(`/get-gifts-by-person?person=${person}`);

                if (!res.ok) {
                    console.error('Server responded with error:', res.status);
                    return [];
                }

                return await res.json();
            } catch (error) {
                console.error('Error loading gifts:', error);
                return [];
            }
        }

        async function displayRSVPs() {
            const rsvps = await loadRSVPs();
            const container = document.getElementById('rsvpItems');
            const listSection = document.getElementById('rsvpList');

            if (rsvps.length === 0) {
                listSection.style.display = 'none';
                return;
            }

            listSection.style.display = 'block';
            container.innerHTML = rsvps.map(rsvp => `
                <div class="rsvp-item">
                    <p><strong>${rsvp.name}</strong> â€” ${rsvp.coming}</p>
                    ${rsvp.drinks ? `<p>${rsvp.drinks}</p>` : ''}
                </div>
            `).join('');
        }

        async function initBingo() {
            const bingoData = await loadBingo();
            const grid = document.getElementById('bingoGrid');

            grid.innerHTML = bingoData.map((cell, index) => {
                const isFree = cell.bingo_text === 'free space';
                const classes = `bingo-cell ${isFree ? 'free' : ''} ${cell.checked ? 'marked' : ''}`;
                return `<div class="${classes}" data-index="${cell.cell_index}">${cell.bingo_text}</div>`;
            }).join('');

            document.querySelectorAll('.bingo-cell:not(.free)').forEach(cell => {
                cell.addEventListener('click', async function () {
                    const index = parseInt(this.dataset.index);
                    const isChecked = this.classList.contains('marked');

                    this.classList.toggle('marked');
                    await updateBingoCell(index, !isChecked);
                });
            });
        }

        async function initGifts() {
            const gifts = await loadGifts();
            const grid = document.getElementById('giftGrid');

            grid.innerHTML = gifts.map(gift => {
                if (gift.link) {
                    return `
                        <a href="${gift.link}" target="_blank" class="gift-item">
                            <h3>${gift.gift_name}</h3>
                            <p>${gift.description}</p>
                        </a>
                    `;
                } else {
                    return `
                        <div class="gift-item">
                            <h3>${gift.gift_name}</h3>
                            <p>${gift.description}</p>
                        </div>
                    `;
                }
            }).join('');
        }

        document.getElementById('rsvpForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const coming = document.getElementById('coming').value;
            const drinks = document.getElementById('drinks').value;

            const confirmation = document.getElementById('confirmation');
            confirmation.textContent = 'sending...';
            confirmation.style.display = 'block';

            const saved = await saveRSVP(name, coming, drinks);

            if (saved) {
                confirmation.textContent = 'received';
                this.reset();
                await displayRSVPs();
                setTimeout(() => {
                    confirmation.style.display = 'none';
                }, 3000);
            } else {
                confirmation.textContent = 'error, try again';
            }
        });

        window.addEventListener('DOMContentLoaded', async () => {
            await displayRSVPs();
            await initBingo();
            await initGifts();
        });
    </script>
</body>

</html>